PROJECT(FreeImage)

CMAKE_MINIMUM_REQUIRED(VERSION 3.4)

SET(FREEIMAGE_VERSION_MAJOR 3)
SET(FREEIMAGE_VERSION_MINOR 17)
SET(FREEIMAGE_VERSION_PATCH 0)
SET(FREEIMAGE_VERSION ${FREEIMAGE_VERSION_MAJOR}${FREEIMAGE_VERSION_MINOR}${FREEIMAGE_VERSION_PATCH})

SET(FREEIMAGE_PROJECT_DIR "${CMAKE_CURRENT_SOURCE_DIR}/../..")
SET(KLAYGE_ROOT_DIR "${FREEIMAGE_PROJECT_DIR}/../..")

SET(RTTI_FORCE_ON TRUE)

INCLUDE(${KLAYGE_ROOT_DIR}/cmake/Common.cmake)
INCLUDE(${KLAYGE_ROOT_DIR}/cmake/Platform.cmake)
INCLUDE(${KLAYGE_ROOT_DIR}/cmake/Compiler.cmake)
INCLUDE(${KLAYGE_ROOT_DIR}/External/Build/CMake/ExternalCommon.cmake)

SET_PROPERTY(GLOBAL PROPERTY USE_FOLDERS ON)

SET(FREEIMAGE_OUTPUT_DIR "${FREEIMAGE_PROJECT_DIR}/lib/${KLAYGE_PLATFORM_NAME}")
SET(KLAYGE_BIN_DIR "${KLAYGE_ROOT_DIR}/KlayGE/bin/${KLAYGE_PLATFORM_NAME}")
SET(REL_PATH "External/Downloads/FreeImage${FREEIMAGE_VERSION}.patched.7z")
SET(SEVENZIP_PATH "${KLAYGE_ROOT_DIR}/External/Downloads/${KLAYGE_HOST_PLATFORM_NAME}/7z")
SET(PACKAGE_COMMIT_ID "8e54811b9d572705cb4e03e4166d3a0bb44872a0")
SET(PACKAGE_FILE_ID "a2bd17fe188a433ab0696bea2861fd09f7fdf757")

DOWNLOAD_PACKAGE("FreeImage" ${REL_PATH} ${PACKAGE_COMMIT_ID} ${PACKAGE_FILE_ID} "Whatsnew.txt")

IF(KLAYGE_COMPILER_MSVC)
	SET(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} /W3 /WX-")
	SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} /W3 /WX-")
	SET(CMAKE_STATIC_LINKER_FLAGS "${CMAKE_STATIC_LINKER_FLAGS} /WX:NO")
ELSE()
	SET(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -Wno-error")
	SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -Wno-error")
ENDIF()
IF(KLAYGE_PLATFORM_WINDOWS)
	ADD_DEFINITIONS(-DWIN32)
ENDIF()

ADD_SUBDIRECTORY(FreeImage)
ADD_SUBDIRECTORY(LibJPEG)
ADD_SUBDIRECTORY(LibJXR)
ADD_SUBDIRECTORY(LibOpenJPEG)
ADD_SUBDIRECTORY(LibPNG)
ADD_SUBDIRECTORY(LibRaw)
ADD_SUBDIRECTORY(LibTIFF4)
ADD_SUBDIRECTORY(LibWebP)
ADD_SUBDIRECTORY(OpenEXR)
ADD_SUBDIRECTORY(ZLib)
